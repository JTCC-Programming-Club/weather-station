<!-- Table of contents can be re-generated by running `npx doctoc README.md` -->
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [Development Setup](#development-setup)
- [Building executables](#building-executables)
- [Production build](#production-build)
- [Migrations](#migrations)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## Development Setup

- Install [PostgreSQL](https://www.postgresql.org/). Other databases are not supported.
- Completely optional, but for development purposes an API client to test HTTP requests such an [Insomnia](https://insomnia.rest/download).
- From a terminal (or powershell for Windows users), install the [diesel cli](https://diesel.rs/guides/getting-started.html#installing-diesel-cli) for database management:

```sh
cargo install diesel_cli
```

- Copy the example config and edit as needed:

```sh
cp .env.example .env
```

- Create and seed the database:

```sh
diesel setup
```

If you ran into an error creating the database, ensure your user has `CREATEDB` permissions by [altering their roles](https://www.postgresql.org/docs/current/sql-alteruser.html): `ALTER USER username CREATEDB;`
If the setup ran successfully, you can now compile and run the server:

```sh
cargo run
```

## Building executables

To just build the executable without running it you can use the `build` command:
```build
cargo build
```

The executable will now be written to the directory `target/debug/`.


## Production build

A binary can be generated by running:

```sh
cargo build --release
```

The difference between running `cargo build` and `cargo build --release` is that the `--release` flag will optimize the build and output a more streamlined executable at the cost of taking longer to build.
This will output the binaries `target/release/server`.
This binaries can be moved and renamed as desired.
To run the executables, you will still need the .env file present in the same directory you run the executables in or optionally pass those environment variables in through other means.

## Migrations

Migrations are a way of "migrating" an existing database schema to a new format.
So if new features are added or fields are renamed from one version of the app to the other, you can run migrations to preserve your existing data but update it to match the schema the current version of the app expects. For more information, go read up on [schema migration](https://en.wikipedia.org/wiki/Schema_migration).
Migrations already ran when the `diesel setup` command was run, but if you are upgrading your version of the app then you can manually trigger migrations like so:

```sh
diesel migrate
```
